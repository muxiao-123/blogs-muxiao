<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>node-express-server | Blogs-Muxiao</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="map map map good good">
    
    <link rel="preload" href="/blogs-muxiao/assets/css/0.styles.1597e3cd.css" as="style"><link rel="preload" href="/blogs-muxiao/assets/js/app.a806e497.js" as="script"><link rel="preload" href="/blogs-muxiao/assets/js/2.78b8a33c.js" as="script"><link rel="preload" href="/blogs-muxiao/assets/js/31.815636a0.js" as="script"><link rel="prefetch" href="/blogs-muxiao/assets/js/10.52a07cd0.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/11.b30c08a7.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/12.3e728434.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/13.1af5f6b2.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/14.2e4a2fb6.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/15.b1f5407a.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/16.510e3c04.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/17.fc6ebf64.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/18.f0519518.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/19.b50ef5e7.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/20.754d23f7.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/21.f480af4d.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/22.91e6c181.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/23.13478913.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/24.ad06b715.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/25.1026cefa.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/26.f1c86ef0.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/27.97108fd7.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/28.ca5581ec.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/29.958d3dc1.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/3.bc3b08de.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/30.0f788922.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/32.89d863b8.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/33.4f964b9b.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/34.93743e4c.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/35.987c0b2f.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/36.3e5df56b.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/37.88fa2c53.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/38.fcbdcaf2.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/39.70e5c939.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/4.11957e18.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/5.1d0585d4.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/6.f2a96706.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/7.ba72b951.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/8.48c4a4d6.js"><link rel="prefetch" href="/blogs-muxiao/assets/js/9.42749e8e.js">
    <link rel="stylesheet" href="/blogs-muxiao/assets/css/0.styles.1597e3cd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blogs-muxiao/" class="home-link router-link-active"><!----> <span class="site-name">Blogs-Muxiao</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blogs-muxiao/node/mine/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs-muxiao/node/mine/" class="nav-link">
  Chinese
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blogs-muxiao/node/mine/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blogs-muxiao/node/mine/" class="nav-link">
  Chinese
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mine</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Html</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Typescript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue3</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Node</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blogs-muxiao/node/" aria-current="page" class="sidebar-link">Node</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blogs-muxiao/node/node-express-server.html" aria-current="page" class="active sidebar-link">搭配express</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blogs-muxiao/node/node-express-server.html#node-express-server" class="sidebar-link">node-express-server</a></li></ul></li><li><a href="/blogs-muxiao/node/node-fs.html" class="sidebar-link">文件模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blogs-muxiao/node/node-fs.html#跨域解决方案" class="sidebar-link">跨域解决方案</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vite</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Eslint</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Plugins</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Markdown</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Issues</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>no-base</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="node-express-server"><a href="#node-express-server" class="header-anchor">#</a> node-express-server</h2> <h3 id="使用nodemailer-模块发送邮件"><a href="#使用nodemailer-模块发送邮件" class="header-anchor">#</a> 使用nodemailer 模块发送邮件</h3> <blockquote><p><code>npm install nodemailer</code></p></blockquote> <h3 id="步骤"><a href="#步骤" class="header-anchor">#</a> 步骤</h3> <p><code>SMTP MSA MTA</code></p> <blockquote><p><code>smtp</code> 简单邮件传输协议 <code>SMTP://...</code> <code>MSA</code> 邮件提交代理 可信的 防止邮件被标记为垃圾箱中， 免费使用 qq gmail 等
<code>mta</code> 邮件传输代理 邮件在互联网上传输</p></blockquote> <h4 id="创建实例"><a href="#创建实例" class="header-anchor">#</a> 创建实例</h4> <ul><li><code>const nodemailer = require('nodemailer')</code></li></ul> <h4 id="创建提交代理"><a href="#创建提交代理" class="header-anchor">#</a> 创建提交代理</h4> <ul><li>代理对象</li> <li>最简单的</li> <li>内置代理服务 qq, gmail 等， 其他灭有的 要自信配置</li> <li><code>auth</code> 通过代理服务器信息， 登录第三方软件中 pass 一般是授权码</li></ul> <p><code>const tansporter = { servive: 'qq', auth: { user: '', pass: '' } }</code></p> <ul><li>没有的 简单配置</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span> <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'smtp.qq.com'</span><span class="token punctuation">,</span> <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">540</span><span class="token punctuation">,</span> <span class="token literal-property property">servive</span><span class="token operator">:</span> <span class="token string">'qq'</span><span class="token punctuation">,</span> <span class="token literal-property property">auth</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre></div><ul><li>通用选项</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span> <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token string">'587'</span><span class="token punctuation">,</span> <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span> <span class="token literal-property property">auth</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">pass</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token punctuation">}</span> authMethod<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">}</span>
</code></pre></div><ul><li><p><code>port</code> – is the port to connect to (defaults to 587 if is secure is false or 465 if true)
host</p></li> <li><p><code>auth</code> – defines authentication data (see authentication section below)</p></li> <li><p><code>authMethod</code> -defines preferred authentication method, defaults to ‘PLAIN’</p></li> <li><p><code>TLS</code> 选项 传输层安全协议 安全套接字 <code>SSL</code> 的规范</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span> <span class="token literal-property property">secure</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> tls<span class="token punctuation">.</span>servername<span class="token operator">:</span> <span class="token string">''</span> <span class="token literal-property property">ignoreTLS</span><span class="token operator">:</span> <span class="token string">''</span> <span class="token literal-property property">requireTLS</span><span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span>
</code></pre></div><p><code>secure</code> – if true the connection will use TLS when connecting to server. If false (the default) then TLS is used if server supports the STARTTLS extension. In most cases set this value to true if you are connecting to port 465. For port 587 or 25 keep it false</p> <p><code>tls</code> – defines additional node.js TLSSocket options to be passed to the socket constructor, eg. {rejectUnauthorized: true}.</p> <p><code>tls.servername</code> - is optional hostname for TLS validation if host was set to an IP address</p> <p><code>ignoreTLS</code> – if this is true and secure is false then TLS is not used even if the server supports STARTTLS extension</p> <p><code>requireTLS</code> <code>const transporter = nodemailer.createTransport(transporter[, default])</code></p> <h4 id="通过代理发送邮件"><a href="#通过代理发送邮件" class="header-anchor">#</a> 通过代理发送邮件</h4> <div class="language-js extra-class"><pre class="language-js"><code>cosnt content <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">from</span><span class="token operator">:</span> <span class="token string">'sendEmail'</span><span class="token punctuation">,</span> <span class="token literal-property property">to</span><span class="token operator">:</span> <span class="token string">'acceptEmail'</span><span class="token punctuation">,</span> <span class="token literal-property property">subject</span><span class="token operator">:</span> <span class="token string">'subject'</span><span class="token punctuation">,</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token literal-property property">html</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h&gt;html&lt;h/&gt;</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span>
</code></pre></div><ul><li><code>transporter.sendEmail(content)</code></li></ul> <h4 id="发送是个异步过程-可返回一个promise-对象"><a href="#发送是个异步过程-可返回一个promise-对象" class="header-anchor">#</a> 发送是个异步过程 可返回一个promise 对象</h4> <h4 id="会话持久话设置"><a href="#会话持久话设置" class="header-anchor">#</a> 会话持久话设置</h4> <ul><li><p>内存 <code>session</code> 不好</p></li> <li><p>数据库 <code>session</code> <code>session-mongoose</code> 不好 仅支持 <code>express 2x,3x connect 2x</code></p></li></ul> <h4 id="使用redis"><a href="#使用redis" class="header-anchor">#</a> 使用redis</h4> <blockquote><p>package redis connec-redis express-session  resdis &gt; 2x redix@4x导入有错误
使用指定版本号 redis@3.1.2</p></blockquote> <h5 id="暴露事件"><a href="#暴露事件" class="header-anchor">#</a> 暴露事件</h5> <blockquote><p>每当连接redis 服务器时都会有事件发生 是个异步过程 不支持原生promise
需引入 polyify  到过 util工具模块 中的 util.promisify 转为promise 使用</p></blockquote> <ol><li>connect 连接</li> <li>ready 建立连接后发出</li> <li>end 断开</li> <li>error 错误</li> <li>reconnecting 重连</li> <li>warning  在设置密码但不需要密码并且使用不推荐使用的选项/功能/类似时发出</li></ol> <h6 id="redis-createclient-redisclient-objec"><a href="#redis-createclient-redisclient-objec" class="header-anchor">#</a> redis.createClient()：RedisClient objec</h6> <ul><li>如果 Redis 服务器与客户端在同一台机器上运行，请尽可能考虑使用 unix 套接字以提高吞吐量。</li> <li>得到服务器实例</li> <li>同一台机器可能没问题 使用默认值 127.0.0.1 6379</li> <li>使用'rediss://...在该协议redis_url将使TLS套接字连接。但是，options如果需要，需要传入额外的 TLS 选项
redis.createClient([options])
redis.createClient(unix_socket[, options])
redis.createClient(redis_url[, options])
redis.createClient(port[, host][, options])</li></ul> <h3 id="express-session"><a href="#express-session" class="header-anchor">#</a> express-session</h3> <p>通过传入对象 实例化一个 <code>session</code>
只是保存 <code>sessionID</code> 在 <code>cookie</code> 自身上， 内容还是保存在服务器上
default 为一个 <code>memoryStore</code> 内存 <code>session</code> 不适用生产环境
可使用 <code>connect-redis</code> 或 <code>connect-mongodb</code> 转为数据库 <code>session</code> 持久话设置
redis 内存数据库 速度快 <code>mongodb</code> 文件数据库 运行稍慢
@ &gt; @1.5 可以不适用 <code>cookie-parser</code> 中间件</p> <h4 id="options"><a href="#options" class="header-anchor">#</a> options</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span> genid<span class="token punctuation">,</span>cookie<span class="token punctuation">,</span>secret<span class="token punctuation">,</span> name<span class="token punctuation">,</span>store<span class="token punctuation">,</span>trustProxy<span class="token punctuation">,</span>resaveSession<span class="token punctuation">,</span>rollingSessions<span class="token punctuation">,</span>saveUninitializedSession <span class="token punctuation">}</span>
<span class="token literal-property property">cookie</span><span class="token operator">:</span> <span class="token punctuation">{</span> httpOnly<span class="token punctuation">,</span> domain<span class="token punctuation">,</span> expires<span class="token punctuation">,</span> maxAge<span class="token punctuation">,</span> path<span class="token punctuation">,</span> sameSite<span class="token punctuation">,</span> secure<span class="token punctuation">,</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="暴露方法"><a href="#暴露方法" class="header-anchor">#</a> 暴露方法</h4> <ul><li><p><code>regenerate sessionID</code> <code>session.regenerate(callback)</code></p></li> <li><p><code>session.destroy(callback)</code></p></li> <li><p>Reloads the session data from the store and re-populates the
<code>req.session</code> object. Once complete, the <code>callback</code> will be invoked.
reload()</p></li> <li><p>Save the session back to the store</p></li> <li><p>This method is automatically called at the end of the HTTP response
save()</p></li> <li><p>Updates the <code>.maxAge</code> property, not need callback
touch()</p></li></ul> <h3 id="store-继承-eventemitter"><a href="#store-继承-eventemitter" class="header-anchor">#</a> <code>Store</code> 继承 <code>EventEmitter</code></h3> <p>方法有</p> <div class="language-js extra-class"><pre class="language-js"><code>store<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>

store<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>sid<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>

store<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>

store<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>

store<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>sid<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>

store<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>sid<span class="token punctuation">,</span> session<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>

store<span class="token punctuation">.</span><span class="token function">touch</span><span class="token punctuation">(</span>sid<span class="token punctuation">,</span> session<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blogs-muxiao/node/" class="prev router-link-active">
        Node
      </a></span> <span class="next"><a href="/blogs-muxiao/node/node-fs.html">
        文件模块
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blogs-muxiao/assets/js/app.a806e497.js" defer></script><script src="/blogs-muxiao/assets/js/2.78b8a33c.js" defer></script><script src="/blogs-muxiao/assets/js/31.815636a0.js" defer></script>
  </body>
</html>
